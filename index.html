<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Blackjack â€” Web Edition</title>
<link rel="icon" href="data:;base64,iVBORw0KGgo=">
<style>
  :root{
    --bg:#0f1724;
    --card-bg:#ffffff;
    --muted:#9aa7b2;
    --accent:#0ea5a4;
    --accent-2:#6366f1;
    --danger:#ef4444;
    --glass: rgba(255,255,255,0.04);
    --glass-2: rgba(255,255,255,0.02);
    --card-shadow: 0 8px 30px rgba(2,6,23,0.6);
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#071025 0%,var(--bg) 100%);color:#e6eef6}
  .app{min-height:100%;display:flex;align-items:center;justify-content:center;padding:28px}
  .board{
    width:100%;max-width:1100px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:14px;padding:18px;box-shadow:var(--card-shadow);display:grid;grid-template-columns:1fr 360px;gap:18px;border:1px solid rgba(255,255,255,0.04);
  }

  /* Left column */
  .game{
    display:flex;flex-direction:column;gap:18px;padding:12px;
  }
  .topbar{display:flex;align-items:center;justify-content:space-between;gap:10px}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{
    width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:800;font-size:18px;color:white;box-shadow:0 6px 18px rgba(99,102,241,0.18)
  }
  .title{font-size:18px;font-weight:700}
  .subtitle{font-size:12px;color:var(--muted)}
  .bank{background:var(--glass);padding:8px 12px;border-radius:8px;display:flex;flex-direction:column;align-items:flex-end;}
  .bank b{font-size:16px}
  /* Play area */
  .play-area{display:flex;flex-direction:column;gap:12px;background:linear-gradient(180deg,var(--glass),var(--glass-2));padding:14px;border-radius:12px}
  .row{display:flex;gap:8px;align-items:center;justify-content:space-between}
  .table{
    background:linear-gradient(180deg,#0b3b34 0%, #053029 100%);padding:18px;border-radius:12px;display:flex;flex-direction:column;gap:14px;border:1px solid rgba(255,255,255,0.03)
  }

  .zone{min-height:120px;display:flex;align-items:flex-end;gap:10px;padding:6px}
  .zone .hand-title{color:var(--muted);font-size:13px;margin-bottom:6px}

  /* card */
  .card{
    width:82px;height:110px;border-radius:10px;background:var(--card-bg);display:flex;flex-direction:column;justify-content:space-between;padding:8px;border:1px solid rgba(10,20,30,0.06);
    box-shadow:0 6px 18px rgba(2,6,23,0.45);font-weight:700;color:#0b1220;
    transition:transform .28s cubic-bezier(.2,.9,.3,1), box-shadow .2s;
    transform-origin:center bottom;
  }
  .card.small{width:64px;height:86px;padding:6px;font-size:13px}
  .card .top,.card .bot{text-align:left}
  .card .suit{font-size:26px;text-align:center;line-height:1}
  .card.red{color:#b91c1c}
  .card.hide{background:linear-gradient(135deg,#243b4a,#152a37);color:#cfe8ec;border:1px solid rgba(255,255,255,0.04)}
  .card:hover{transform:translateY(-8px);box-shadow:0 18px 40px rgba(2,6,23,0.6)}
  .controls{display:flex;gap:10px;flex-wrap:wrap}
  button.btn{background:linear-gradient(180deg,#0ea5a4,#089a95);border:none;padding:10px 14px;border-radius:10px;color:white;font-weight:700;cursor:pointer;box-shadow:0 10px 22px rgba(14,165,164,0.12)}
  button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);font-weight:600;padding:8px 12px;border-radius:10px}
  button.warn{background:linear-gradient(180deg,#f97316,#ef6c00)}
  button.danger{background:linear-gradient(180deg,#ef4444,#dc2626)}
  button:disabled{opacity:0.5;cursor:not-allowed;transform:none;box-shadow:none}

  /* right column */
  .sidebar{padding:12px;display:flex;flex-direction:column;gap:12px}
  .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
  .panel h4{margin:0 0 8px 0}
  .bet-row{display:flex;gap:8px;align-items:center}
  input[type=number]{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
  .history{max-height:240px;overflow:auto;font-size:13px;color:var(--muted)}
  .stat-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .chip{background:linear-gradient(180deg,#ffe8b3,#ffd780);padding:8px;border-radius:8px;text-align:center;font-weight:800}

  /* footer */
  .footer{font-size:12px;color:var(--muted);text-align:center;padding-top:6px}

  /* responsive */
  @media (max-width:980px){
    .board{grid-template-columns:1fr;max-width:820px}
    .sidebar{order:2}
  }
</style>
</head>
<body>
<div class="app">
  <div class="board" role="application" aria-label="Blackjack game board">
    <div class="game" role="main">
      <div class="topbar">
        <div class="brand">
          <div class="logo">BJ</div>
          <div>
            <div class="title">Blackjack â€” Web Edition</div>
            <div class="subtitle">Classic rules Â· Dealer stands on soft 17</div>
          </div>
        </div>
        <div class="bank" aria-live="polite">
          <div class="subtitle">Bankroll</div>
          <div><b id="bankAmount">$1000</b></div>
          <div class="subtitle" style="font-size:12px" id="roundMsg">Ready</div>
        </div>
      </div>

      <div class="play-area">
        <div class="table" aria-label="blackjack table">
          <div>
            <div class="zone" id="dealerZone">
              <div style="flex:1">
                <div class="hand-title">Dealer</div>
                <div id="dealerCards" style="display:flex;gap:10px;align-items:flex-end"></div>
                <div style="color:var(--muted);font-size:13px;margin-top:6px">Total: <span id="dealerTotal">â€”</span></div>
              </div>
            </div>
          </div>

          <div style="border-top:1px dashed rgba(255,255,255,0.03);padding-top:12px">
            <div class="zone" id="playerZone">
              <div style="flex:1">
                <div class="hand-title">Player</div>
                <div id="playerCards" style="display:flex;gap:10px;align-items:flex-end"></div>
                <div style="color:var(--muted);font-size:13px;margin-top:6px">Total: <span id="playerTotal">â€”</span></div>
              </div>
            </div>
          </div>

          <div class="row" style="margin-top:8px;align-items:center">
            <div class="controls" role="group" aria-label="game controls">
              <button class="btn" id="btnDeal">Deal</button>
              <button class="btn" id="btnHit" disabled>Hit</button>
              <button class="btn" id="btnStand" disabled>Stand</button>
              <button class="btn" id="btnDouble" disabled>Double</button>
              <button class="ghost" id="btnReset">Reset Bank</button>
            </div>

            <div style="display:flex;align-items:center;gap:10px">
              <div style="font-size:13px;color:var(--muted)">Bet</div>
              <input id="betInput" type="number" min="1" step="1" value="10" style="width:88px">
              <div class="chip" id="betPreview">$10</div>
            </div>
          </div>

        </div>
      </div>

      <div class="footer">Built for GitHub Pages â€¢ Save using localStorage â€¢ Cards use Unicode suits â™  â™¥ â™¦ â™£</div>
    </div>

    <aside class="sidebar" aria-label="sidebar">
      <div class="panel">
        <h4>Game Info</h4>
        <div style="display:flex;gap:8px;align-items:center;justify-content:space-between">
          <div style="font-size:13px;color:var(--muted)">Wins</div><div id="statWins">0</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center;justify-content:space-between;margin-top:6px">
          <div style="font-size:13px;color:var(--muted)">Losses</div><div id="statLosses">0</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center;justify-content:space-between;margin-top:6px">
          <div style="font-size:13px;color:var(--muted)">Pushes</div><div id="statPushes">0</div>
        </div>
      </div>

      <div class="panel">
        <h4>History</h4>
        <div class="history" id="historyList" aria-live="polite"></div>
      </div>

      <div class="panel">
        <h4>Settings</h4>
        <div style="font-size:13px;color:var(--muted)">Decks</div>
        <select id="deckCount" style="width:100%;padding:8px;margin-top:6px;border-radius:8px;background:transparent;color:inherit">
          <option value="1">1 deck</option>
          <option value="2">2 decks</option>
          <option value="4">4 decks</option>
        </select>
        <div style="margin-top:10px;font-size:13px;color:var(--muted)">Autoplay (for testing)</div>
        <div style="display:flex;gap:8px;margin-top:6px">
          <button class="ghost" id="autoOn">Start</button>
          <button class="ghost" id="autoOff">Stop</button>
        </div>
      </div>
    </aside>
  </div>
</div>

<script>
/* Blackjack Web App
   - Single file
   - Correct Ace handling
   - Dealer stands on soft 17
*/
(() => {
  // DOM
  const bankEl = document.getElementById('bankAmount');
  const roundMsg = document.getElementById('roundMsg');
  const dealerCards = document.getElementById('dealerCards');
  const playerCards = document.getElementById('playerCards');
  const playerTotal = document.getElementById('playerTotal');
  const dealerTotal = document.getElementById('dealerTotal');
  const btnDeal = document.getElementById('btnDeal');
  const btnHit = document.getElementById('btnHit');
  const btnStand = document.getElementById('btnStand');
  const btnDouble = document.getElementById('btnDouble');
  const btnReset = document.getElementById('btnReset');
  const betInput = document.getElementById('betInput');
  const betPreview = document.getElementById('betPreview');
  const historyList = document.getElementById('historyList');
  const statWins = document.getElementById('statWins');
  const statLosses = document.getElementById('statLosses');
  const statPushes = document.getElementById('statPushes');
  const deckCountSel = document.getElementById('deckCount');
  const autoOn = document.getElementById('autoOn'), autoOff = document.getElementById('autoOff');

  // state
  let bank = Number(localStorage.getItem('bj_bank')) || 1000;
  let stats = JSON.parse(localStorage.getItem('bj_stats') || '{"wins":0,"losses":0,"pushes":0}');
  let history = JSON.parse(localStorage.getItem('bj_history') || '[]');
  let deck = [], player = [], dealer = [];
  let inRound = false, bet = Number(betInput.value) || 10;
  let decks = Number(deckCountSel.value) || 1;
  let autoplayTimer = null;

  // card helpers
  const ranks = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
  const suits = ['â™ ','â™¥','â™¦','â™£'];

  function buildDeck(n=1){
    const d = [];
    for (let k=0;k<n;k++){
      for (const s of suits){
        for (const r of ranks){
          d.push({rank:r,suit:s});
        }
      }
    }
    return d;
  }

  function shuffle(array){
    for (let i=array.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [array[i], array[j]] = [array[j], array[i]];
    }
  }

  function draw(){
    if (deck.length === 0) {
      deck = buildDeck(decks);
      shuffle(deck);
      addHistory('Deck reshuffled');
    }
    return deck.pop();
  }

  function cardValue(card){
    if (card.rank === 'A') return 11;
    if (['J','Q','K'].includes(card.rank)) return 10;
    return parseInt(card.rank,10);
  }

  // returns best total (use Aces as 1 or 11)
  function bestTotal(hand){
    let total = hand.reduce((s,c)=>s+cardValue(c),0);
    let aces = hand.filter(c=>c.rank==='A').length;
    while (total > 21 && aces > 0){
      total -= 10; aces--;
    }
    return total;
  }

  function isSoftTotal(hand){
    // soft if contains an Ace counted as 11
    let total = hand.reduce((s,c)=>s+cardValue(c),0);
    return hand.some(c=>c.rank==='A') && total <= 21;
  }

  // UI rendering
  function renderCards(){
    // dealer
    dealerCards.innerHTML = '';
    for (let i=0;i<dealer.length;i++){
      const c = dealer[i];
      const el = makeCardElement(c, (i===0 && inRound)); // hide first card if inRound
      dealerCards.appendChild(el);
    }
    // player
    playerCards.innerHTML = '';
    for (const c of player){
      playerCards.appendChild(makeCardElement(c,false));
    }
    playerTotal.textContent = inRound ? bestTotal(player) : bestTotal(player);
    dealerTotal.textContent = inRound ? (inRound ? 'â€”' : bestTotal(dealer)) : bestTotal(dealer);
    bankEl.textContent = '$' + bank.toFixed(2);
    betPreview.textContent = '$' + bet;
    statWins.textContent = stats.wins;
    statLosses.textContent = stats.losses;
    statPushes.textContent = stats.pushes;
    // history
    historyList.innerHTML = '';
    for (const h of history.slice(0,30)){
      const d = document.createElement('div');
      d.style.padding = '6px 0'; d.style.borderBottom = '1px solid rgba(255,255,255,0.02)';
      d.style.fontSize='13px'; d.style.color='var(--muted)';
      d.textContent = `${new Date(h.t).toLocaleTimeString()} â€¢ ${h.msg}`;
      historyList.appendChild(d);
    }
  }

  function makeCardElement(card, hide=false){
    const div = document.createElement('div');
    div.className = 'card' + (hide ? ' hide' : '');
    // size small when many cards
    if ((hide?1:1) && (player.length > 6 || dealer.length > 6)) div.classList.add('small');
    if (hide){
      div.innerHTML = '<div style="text-align:center;font-size:22px;margin-top:18px">ðŸ‚ </div>';
      return div;
    }
    const isRed = (card.suit === 'â™¥' || card.suit === 'â™¦');
    if (isRed) div.classList.add('red');
    // content
    div.innerHTML = `<div class="top">${card.rank}</div><div class="suit">${card.suit}</div><div class="bot" style="text-align:right">${card.rank}</div>`;
    return div;
  }

  // history helper
  function addHistory(msg){
    history.unshift({t:Date.now(), msg});
    history = history.slice(0,200);
    localStorage.setItem('bj_history', JSON.stringify(history));
    renderCards();
  }

  // outcomes & payouts
  function endRound(reason, payout=0){
    inRound = false;
    // apply payout (positive => player wins that amount, negative => player loses)
    bank += payout;
    if (payout > 0){
      addHistory(`Win: ${reason} (+$${payout.toFixed(2)})`);
      stats.wins++;
    } else if (payout < 0){
      addHistory(`Lose: ${reason} (-$${Math.abs(payout).toFixed(2)})`);
      stats.losses++;
    } else {
      addHistory(`Push: ${reason}`);
      stats.pushes++;
    }
    saveState();
    updateButtons();
    renderCards();
    roundMsg.textContent = reason;
  }

  function saveState(){
    localStorage.setItem('bj_bank', bank);
    localStorage.setItem('bj_stats', JSON.stringify(stats));
    localStorage.setItem('bj_history', JSON.stringify(history));
  }

  // Game actions
  function deal(){
    if (inRound) return;
    bet = Math.max(1, Number(betInput.value) || 1);
    if (bet > bank) { alert('Bet exceeds bankroll. Lower your bet.'); return; }
    // prepare deck if needed
    if (!deck || deck.length < 15){
      deck = buildDeck(decks);
      shuffle(deck);
      addHistory('New deck created');
    }

    // reset hands
    player = []; dealer = [];
    // initial cards: P, D, P, D
    player.push(draw()); dealer.push(draw());
    player.push(draw()); dealer.push(draw());
    inRound = true;
    // place bet (stake reserved)
    bank -= bet;
    saveState();
    updateButtons();
    renderCards();

    // check immediates (blackjack)
    const pTotal = bestTotal(player), dTotal = bestTotal(dealer);
    if (pTotal === 21 || dTotal === 21){
      // reveal dealer
      renderCards();
      if (pTotal === 21 && dTotal !== 21){
        // player blackjack pays 3:2
        const win = Math.round(bet * 1.5 * 100)/100;
        endRound('Blackjack', bet + win); // return stake + win
      } else if (dTotal === 21 && pTotal !== 21){
        endRound('Dealer Blackjack', -0); // already subtracted bet when dealing -> player loses stake
      } else {
        // both blackjack = push (return stake)
        endRound('Push (both Blackjack)', bet);
      }
      return;
    }
    roundMsg.textContent = 'Your move';
    renderCards();
  }

  function playerHit(){
    if (!inRound) return;
    player.push(draw());
    renderCards();
    const total = bestTotal(player);
    if (total > 21){
      // busted
      endRound(`Busted (${total})`, 0); // stake already subtracted, no payout
    } else {
      roundMsg.textContent = 'Your move';
    }
    updateButtons();
  }

  function playerStand(){
    if (!inRound) return;
    // reveal and dealer plays
    dealerPlay();
  }

  function playerDouble(){
    if (!inRound) return;
    if (player.length !== 2) return;
    if (bank < bet) { alert('Insufficient bankroll to double down'); return; }
    bank -= bet; // match bet (stake)
    bet = bet * 2;
    player.push(draw());
    renderCards();
    const total = bestTotal(player);
    if (total > 21){
      endRound(`Busted after double (${total})`, 0);
    } else {
      dealerPlay();
    }
  }

  function dealerPlay(){
    // reveal dealer and hit until 17 or higher
    renderCards();
    function dealerTotalSoft17(){
      return bestTotal(dealer);
    }
    // dealer hits while <17; stands on soft 17
    while (true){
      const dVal = bestTotal(dealer);
      // count soft: if there's an Ace counted as 11 produce a 'soft' state
      // We treat "stand on soft 17" => dealer stops if dVal >= 17
      if (dVal < 17){
        dealer.push(draw());
        renderCards();
      } else {
        break;
      }
    }
    // determine result
    const pVal = bestTotal(player), dVal = bestTotal(dealer);
    if (dVal > 21){
      // dealer busts -> player wins equal to stake
      endRound(`Dealer busted (${dVal})`, bet * 2); // return stake + win (we already subtracted stake at deal)
    } else if (pVal > dVal){
      endRound(`You ${pVal} vs Dealer ${dVal}`, bet * 2);
    } else if (pVal < dVal){
      endRound(`You ${pVal} vs Dealer ${dVal}`, 0);
    } else {
      // push: return stake
      endRound(`Push (${pVal})`, bet);
    }
    // reset bet to default for next round
    betInput.value = Math.max(1, Math.round(Number(betInput.value) || 10));
    bet = Number(betInput.value);
    saveState();
  }

  function updateButtons(){
    btnHit.disabled = !inRound;
    btnStand.disabled = !inRound;
    btnDouble.disabled = !(inRound && player.length===2 && bank >= bet);
    btnDeal.disabled = inRound;
    betInput.disabled = inRound;
  }

  // events
  btnDeal.addEventListener('click', deal);
  btnHit.addEventListener('click', playerHit);
  btnStand.addEventListener('click', playerStand);
  btnDouble.addEventListener('click', playerDouble);
  btnReset.addEventListener('click', ()=>{
    if (confirm('Reset bankroll to $1000 and clear stats?')){
      bank = 1000; stats = {wins:0,losses:0,pushes:0}; history=[]; saveState(); renderCards();
    }
  });
  betInput.addEventListener('input', ()=> {
    bet = Math.max(1, Number(betInput.value) || 1);
    betPreview.textContent = '$' + bet;
  });
  deckCountSel.addEventListener('change', ()=> { decks = Number(deckCountSel.value); deck=[]; addHistory(`Deck count set to ${decks}`); });

  autoOn.addEventListener('click', ()=>{
    if (autoplayTimer) return;
    autoplayTimer = setInterval(()=>{
      if (!inRound) deal();
      if (inRound){
        // simple autoplayer: hit until >=16
        const t = bestTotal(player);
        if (t < 16) playerHit();
        else playerStand();
      }
      if (bank <= 0) { clearInterval(autoplayTimer); autoplayTimer = null; addHistory('Autoplay stopped (bankrupt)'); }
    }, 800);
    addHistory('Autoplay started');
  });
  autoOff.addEventListener('click', ()=>{
    clearInterval(autoplayTimer); autoplayTimer = null; addHistory('Autoplay stopped');
  });

  // init
  function init(){
    deck = buildDeck(decks);
    shuffle(deck);
    renderCards();
    roundMsg.textContent = 'Ready';
    saveState();
  }
  init();

})();
</script>
</body>
</html>

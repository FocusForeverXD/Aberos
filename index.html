<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Blackjack â€” (Stable)</title>
<style>
  :root{
    --bg:#071026;
    --card-bg:#ffffff;
    --muted:#9fb0bf;
    --accent:#0ea5a4;
    --glow: rgba(14,165,164,0.22);
    --ui-scale:1;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,Segoe UI,system-ui,Arial;background:radial-gradient(circle at 20% 10%, #0b2f2a 0%, var(--bg) 60%);color:#e6eef6}
  .wrap{min-height:100vh;padding:20px;display:flex;align-items:flex-start;justify-content:center}
  .container{width:100%;max-width:1100px;display:grid;grid-template-columns:1fr 340px;gap:18px;transform:scale(var(--ui-scale));transition:transform .12s ease}
  @media (max-width:900px){ .container{grid-template-columns:1fr; } }
  .cardBox{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.04);box-shadow:0 12px 30px var(--glow)}
  .top{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
  .logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#6366f1);display:flex;align-items:center;justify-content:center;font-weight:700}
  .tableArea{background:linear-gradient(180deg,#073936 0%, #042825 100%);padding:12px;border-radius:10px}
  .hand{min-height:110px;padding:8px;border-radius:8px}
  .handRow{display:flex;gap:10px;flex-wrap:wrap;align-items:flex-end}
  .card{width:78px;height:106px;border-radius:10px;background:var(--card-bg);padding:8px;display:flex;flex-direction:column;justify-content:space-between;border:1px solid rgba(0,0,0,0.06);font-weight:700;color:#081018;transform-origin:center;transition:transform .28s}
  .card.small{width:62px;height:86px;padding:6px;font-size:13px}
  .card.red{color:#b91c1c}
  .card.back{background:linear-gradient(135deg,#243a47,#142c37);color:#cfe8ec}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  button.btn{background:linear-gradient(180deg,var(--accent),#089a95);border:none;padding:10px 12px;border-radius:10px;color:white;font-weight:800;cursor:pointer}
  button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);padding:8px;border-radius:8px}
  .sidebar{display:flex;flex-direction:column;gap:12px}
  .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
  .history{max-height:360px;overflow:auto}
  .history-item{padding:8px;border-radius:8px;margin-bottom:8px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.008));font-size:13px}
  .outcome-win{color:#6ee7b7;font-weight:800}
  .outcome-lose{color:#fca5a5;font-weight:800}
  .outcome-push{color:#fde68a;font-weight:800}
  label.small{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
  input[type=color]{width:56px;height:36px;border-radius:6px;border:none;padding:0}
  input[type=range]{width:100%}
  footer{margin-top:8px;color:var(--muted);font-size:13px}
</style>
</head>
<body>
<div class="wrap">
  <div class="container" id="container">
    <!-- Game -->
    <div class="cardBox">
      <div class="top">
        <div style="display:flex;gap:12px;align-items:center">
          <div class="logo">BJ</div>
          <div>
            <div style="font-weight:800">Blackjack â€” Stable</div>
            <div style="font-size:13px;color:var(--muted)">Dealer stands on soft 17</div>
          </div>
        </div>
        <div style="text-align:right">
          <div style="font-size:13px;color:var(--muted)">Bank</div>
          <div style="font-weight:800" id="bankAmount">$1000</div>
          <div id="roundMsg" style="font-size:13px;color:var(--muted)">Ready</div>
        </div>
      </div>

      <div class="tableArea">
        <div class="hand">
          <div style="font-size:13px;color:var(--muted);margin-bottom:6px">Dealer</div>
          <div class="handRow" id="dealerRow"></div>
          <div style="margin-top:6px;color:var(--muted)">Total: <span id="dealerTotal">â€”</span></div>
        </div>

        <div style="height:12px"></div>

        <div class="hand">
          <div style="font-size:13px;color:var(--muted);margin-bottom:6px">Player</div>
          <div class="handRow" id="playerRow"></div>
          <div style="margin-top:6px;color:var(--muted)">Total: <span id="playerTotal">â€”</span></div>
        </div>

        <div class="controls">
          <button class="btn" id="dealBtn">Deal</button>
          <button class="btn" id="hitBtn" disabled>Hit</button>
          <button class="btn" id="standBtn" disabled>Stand</button>
          <button class="btn" id="doubleBtn" disabled>Double</button>
          <button class="ghost" id="resetBtn">Reset</button>
        </div>

        <div style="display:flex;gap:10px;align-items:center;margin-top:12px">
          <div style="flex:1">
            <label class="small">Bet</label>
            <input id="betInput" type="number" min="1" value="10" style="width:100%;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit">
          </div>
          <div style="width:110px;text-align:right">
            <div class="small" style="color:var(--muted)">Preview</div>
            <div style="background:linear-gradient(180deg,#ffe8b3,#ffd780);padding:8px;border-radius:8px;font-weight:800" id="betPreview">$10</div>
          </div>
        </div>
      </div>
      <footer>Persistent history & theme</footer>
    </div>

    <!-- Sidebar -->
    <div class="sidebar">
      <div class="panel">
        <h4 style="margin:0 0 8px 0">History</h4>
        <div class="history" id="historyList"></div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="ghost" id="clearHistory">Clear</button>
          <button class="ghost" id="exportHistory">Export</button>
        </div>
      </div>

      <div class="panel">
        <h4 style="margin:0 0 8px 0">Customize</h4>
        <div style="margin-bottom:8px">
          <div style="font-size:13px;color:var(--muted);margin-bottom:6px">Presets</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button class="ghost" id="presetNeon">Neon</button>
            <button class="ghost" id="presetRed">Red</button>
            <button class="ghost" id="presetGreen">Green</button>
            <button class="ghost" id="presetGold">Gold</button>
          </div>
        </div>

        <div style="margin-top:8px">
          <label class="small">Background</label>
          <input type="color" id="bgColor" />
        </div>
        <div style="margin-top:8px">
          <label class="small">Accent</label>
          <input type="color" id="accentColor" />
        </div>
        <div style="margin-top:8px">
          <label class="small">Glow (alpha)</label>
          <input type="color" id="glowColor" />
        </div>
        <div style="margin-top:8px">
          <label class="small">UI Scale</label>
          <input id="scaleRange" type="range" min="0.75" max="1.25" step="0.01" value="1" />
          <div id="scaleVal">100%</div>
        </div>

        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="ghost" id="saveTheme">Save</button>
          <button class="ghost" id="resetTheme">Reset</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
/* Stable Blackjack simplified implementation with history + simple theme */
(function(){
  // DOM refs
  const dealerRow = document.getElementById('dealerRow');
  const playerRow = document.getElementById('playerRow');
  const dealerTotal = document.getElementById('dealerTotal');
  const playerTotal = document.getElementById('playerTotal');
  const bankAmountEl = document.getElementById('bankAmount');
  const roundMsg = document.getElementById('roundMsg');
  const historyList = document.getElementById('historyList');
  const betInput = document.getElementById('betInput');
  const betPreview = document.getElementById('betPreview');

  const dealBtn = document.getElementById('dealBtn');
  const hitBtn = document.getElementById('hitBtn');
  const standBtn = document.getElementById('standBtn');
  const doubleBtn = document.getElementById('doubleBtn');
  const resetBtn = document.getElementById('resetBtn');

  // theme controls
  const presetNeon = document.getElementById('presetNeon');
  const presetRed = document.getElementById('presetRed');
  const presetGreen = document.getElementById('presetGreen');
  const presetGold = document.getElementById('presetGold');
  const bgColor = document.getElementById('bgColor');
  const accentColor = document.getElementById('accentColor');
  const glowColor = document.getElementById('glowColor');
  const scaleRange = document.getElementById('scaleRange');
  const scaleVal = document.getElementById('scaleVal');
  const saveThemeBtn = document.getElementById('saveTheme');
  const resetThemeBtn = document.getElementById('resetTheme');

  const clearHistoryBtn = document.getElementById('clearHistory');
  const exportHistoryBtn = document.getElementById('exportHistory');

  // data
  const SUITS = ['â™ ','â™¥','â™¦','â™£'];
  const RANKS = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];

  let deck = [];
  let player = [];
  let dealer = [];
  let inRound = false;
  let bank = Number(localStorage.getItem('bj_bank') || 1000);
  let history = JSON.parse(localStorage.getItem('bj_history') || '[]');
  let stats = JSON.parse(localStorage.getItem('bj_stats') || JSON.stringify({wins:0,losses:0,pushes:0,rounds:0}));
  let theme = JSON.parse(localStorage.getItem('bj_theme') || '{}');

  // helpers
  function buildDeck(){
    const d = [];
    for(const s of SUITS) for(const r of RANKS) d.push({suit:s,rank:r});
    for(let i=d.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[d[i],d[j]]=[d[j],d[i]]}
    return d;
  }
  function draw(){
    if(deck.length < 8){ deck = buildDeck(); addHistory('Deck reshuffled'); }
    return deck.pop();
  }
  function valueOf(c){
    if(c.rank === 'A') return 11;
    if(['J','Q','K'].includes(c.rank)) return 10;
    return Number(c.rank);
  }
  function bestTotal(hand){
    let total = hand.reduce((s,c)=>s+valueOf(c),0);
    let aces = hand.filter(x=>x.rank==='A').length;
    while(total>21 && aces>0){ total -= 10; aces--; }
    return total;
  }
  function clearEl(el){ while(el.firstChild) el.removeChild(el.firstChild); }

  // render
  function makeCardNode(card, hidden=false){
    const d = document.createElement('div');
    d.className = 'card' + (hidden?' back':'');
    d.style.transform = 'translateY(0)';
    if(hidden){ d.textContent = 'ðŸ‚ '; return d; }
    d.innerHTML = '<div style="font-size:14px">'+card.rank+'</div><div style="font-size:22px;line-height:1">'+card.suit+'</div><div style="text-align:right;font-size:14px">'+card.rank+'</div>';
    if(card.suit==='â™¥' || card.suit==='â™¦') d.classList.add('red');
    return d;
  }

  function renderHands(){
    clearEl(dealerRow); clearEl(playerRow);
    for(let i=0;i<dealer.length;i++){
      const hide = (i===0 && inRound);
      dealerRow.appendChild(makeCardNode(dealer[i], hide));
    }
    for(const c of player) playerRow.appendChild(makeCardNode(c,false));
    dealerTotal.textContent = inRound ? (inRound ? 'â€”' : bestTotal(dealer)) : (dealer.length?bestTotal(dealer):'â€”');
    playerTotal.textContent = player.length?bestTotal(player):'â€”';
    bankAmountEl.textContent = '$' + bank.toFixed(2);
    betPreview.textContent = '$' + (Number(betInput.value)||1);
    updateButtons();
  }

  function updateButtons(){
    dealBtn.disabled = inRound;
    hitBtn.disabled = !inRound;
    standBtn.disabled = !inRound;
    doubleBtn.disabled = !(inRound && player.length===2 && bank >= Number(betInput.value||1));
  }

  // history
  function addHistory(msg, outcome){
    const entry = { t: Date.now(), msg: msg, outcome: outcome, player: player.map(c=>c.rank+c.suit), dealer: dealer.map(c=>c.rank+c.suit), pTotal: bestTotal(player), dTotal: bestTotal(dealer) };
    history.unshift(entry); if(history.length>200) history.pop();
    localStorage.setItem('bj_history', JSON.stringify(history));
    renderHistory();
  }
  function renderHistory(){
    clearEl(historyList);
    for(const h of history){
      const div = document.createElement('div'); div.className='history-item';
      const line1 = document.createElement('div'); line1.style.display='flex'; line1.style.justifyContent='space-between';
      line1.innerHTML = `<div style="color:var(--muted)">${new Date(h.t).toLocaleTimeString()}</div><div>${h.outcome? (h.outcome==='win'?'<span class="outcome-win">WIN</span>':(h.outcome==='lose'?'<span class="outcome-lose">LOSE</span>':'<span class="outcome-push">PUSH</span>')):''}</div>`;
      const line2 = document.createElement('div'); line2.style.color='var(--muted)'; line2.style.fontSize='13px';
      line2.textContent = `${h.msg} Â· P:${h.player.join(' ')} (${h.pTotal}) Â· D:${h.dealer.join(' ')} (${h.dTotal})`;
      div.appendChild(line1); div.appendChild(line2); historyList.appendChild(div);
    }
  }

  // game actions
  function deal(){
    if(inRound) return;
    const stake = Number(betInput.value||1);
    if(stake<1) return alert('Bet must be >= 1');
    if(stake>bank) return alert('Bet exceeds bankroll');
    if(!deck.length) deck = buildDeck();
    player = []; dealer = [];
    player.push(draw()); dealer.push(draw()); player.push(draw()); dealer.push(draw());
    bank -= stake; inRound = true; roundMsg.textContent = 'Your move';
    renderHands();
    // immediate blackjack check
    const p = bestTotal(player), d = bestTotal(dealer);
    if(p===21 || d===21){
      inRound=false; renderHands();
      if(p===21 && d!==21){ const win = Math.round(stake*1.5*100)/100; bank += stake + win; addHistory('Blackjack','win'); roundMsg.textContent = `Blackjack! +$${win}`; stats.wins++; }
      else if(d===21 && p!==21){ addHistory('Dealer Blackjack','lose'); roundMsg.textContent = 'Dealer Blackjack â€” you lose'; stats.losses++; }
      else{ bank += stake; addHistory('Both Blackjack â€” push','push'); roundMsg.textContent = 'Push (both)'; stats.pushes++; }
      stats.rounds++; saveState(); renderHistory(); updateButtons();
    }
  }

  function hit(){
    if(!inRound) return;
    player.push(draw()); renderHands();
    if(bestTotal(player)>21){ inRound=false; addHistory('Busted','lose'); roundMsg.textContent='Busted â€” you lose'; stats.losses++; stats.rounds++; saveState(); renderHistory(); updateButtons(); }
  }

  function stand(){
    if(!inRound) return;
    // dealer plays
    while(bestTotal(dealer) < 17) dealer.push(draw());
    inRound=false;
    const p = bestTotal(player), d = bestTotal(dealer);
    const stake = Number(betInput.value||1);
    if(d>21 || p>d){ bank += stake*2; addHistory('Win','win'); roundMsg.textContent = `You win ${p} vs ${d}`; stats.wins++; }
    else if(p<d){ addHistory('Lose','lose'); roundMsg.textContent = `You lose ${p} vs ${d}`; stats.losses++; }
    else{ bank += stake; addHistory('Push','push'); roundMsg.textContent=`Push (${p})`; stats.pushes++; }
    stats.rounds++; saveState(); renderHistory(); renderHands(); updateButtons();
  }

  function doubleDown(){
    if(!inRound || player.length !== 2) return;
    const stake = Number(betInput.value||1);
    if(bank < stake) return alert('Not enough bankroll to double');
    bank -= stake; betInput.value = stake * 2;
    player.push(draw()); renderHands();
    if(bestTotal(player)>21){ inRound=false; addHistory('Busted after double','lose'); roundMsg.textContent='Busted â€” you lose'; stats.losses++; stats.rounds++; saveState(); renderHistory(); updateButtons(); return; }
    stand();
    // after settle, reset betInput to original suggestion
    setTimeout(()=>{ betInput.value = Math.max(1, Math.round(Number(betInput.value)/2)); renderHands(); }, 200);
  }

  // persistence
  function saveState(){ localStorage.setItem('bj_bank', String(bank)); localStorage.setItem('bj_stats', JSON.stringify(stats)); localStorage.setItem('bj_history', JSON.stringify(history)); }
  function loadState(){ bank = Number(localStorage.getItem('bj_bank') || bank); stats = JSON.parse(localStorage.getItem('bj_stats') || JSON.stringify(stats)); history = JSON.parse(localStorage.getItem('bj_history') || '[]'); renderHistory(); }
  // init
  function init(){
    loadState(); deck = buildDeck(); renderHands(); updateButtons();
    bankAmountEl.textContent = '$' + bank.toFixed(2);
  }

  // events
  dealBtn.addEventListener('click', deal);
  hitBtn.addEventListener('click', hit);
  standBtn.addEventListener('click', stand);
  doubleBtn.addEventListener('click', doubleDown);
  resetBtn.addEventListener('click', ()=>{
    if(confirm('Reset bankroll and stats?')){
      localStorage.removeItem('bj_bank'); localStorage.removeItem('bj_history'); localStorage.removeItem('bj_stats');
      bank = 1000; history = []; stats = {wins:0,losses:0,pushes:0,rounds:0}; saveState(); renderHistory(); renderHands(); roundMsg.textContent = 'Reset';
    }
  });

  betInput.addEventListener('input', ()=>{ betPreview.textContent = '$' + (Number(betInput.value)||1); updateButtons(); });

  clearHistoryBtn.addEventListener('click', ()=>{ if(confirm('Clear history?')){ history=[]; localStorage.removeItem('bj_history'); renderHistory(); }});
  exportHistoryBtn.addEventListener('click', ()=>{ navigator.clipboard?.writeText(JSON.stringify(history, null, 2)).then(()=>alert('History copied to clipboard')); });

  // theme / presets (simple)
  const presets = {
    neon: {bg:'#071026', accent:'#0ea5a4', glow:'rgba(14,165,164,0.22)'},
    red: {bg:'#1b0505', accent:'#ef4444', glow:'rgba(239,68,68,0.16)'},
    green: {bg:'#052014', accent:'#10b981', glow:'rgba(16,185,129,0.16)'},
    gold: {bg:'#1b1406', accent:'#f59e0b', glow:'rgba(245,158,11,0.12)'}
  };
  function applyTheme(t){
    if(!t) return;
    document.documentElement.style.setProperty('--bg', t.bg || getComputedStyle(document.documentElement).getPropertyValue('--bg'));
    document.documentElement.style.setProperty('--accent', t.accent || getComputedStyle(document.documentElement).getPropertyValue('--accent'));
    document.documentElement.style.setProperty('--glow', t.glow || getComputedStyle(document.documentElement).getPropertyValue('--glow'));
    // color inputs reflect current colors
    try { bgColor.value = rgbToHex(t.bg); accentColor.value = rgbToHex(t.accent); glowColor.value = rgbToHex(rgbFromRgba(t.glow)); } catch(e){}
  }
  function rgbToHex(s){ if(!s) return '#000000'; const el = document.createElement('div'); el.style.color=s; document.body.appendChild(el); const cs = getComputedStyle(el).color; document.body.removeChild(el); const m = cs.match(/rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)/); if(!m) return '#000000'; return '#'+[1,2,3].map(i=>parseInt(m[i]).toString(16).padStart(2,'0')).join(''); }
  function rgbFromRgba(rgba){ if(!rgba) return rgba; const m = rgba.match(/rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)/); if(!m) return rgba; return `rgb(${m[1]},${m[2]},${m[3]})`; }

  presetNeon.addEventListener('click', ()=>{ theme = presets.neon; applyTheme(theme); localStorage.setItem('bj_theme', JSON.stringify(theme)); });
  presetRed.addEventListener('click', ()=>{ theme = presets.red; applyTheme(theme); localStorage.setItem('bj_theme', JSON.stringify(theme)); });
  presetGreen.addEventListener('click', ()=>{ theme = presets.green; applyTheme(theme); localStorage.setItem('bj_theme', JSON.stringify(theme)); });
  presetGold.addEventListener('click', ()=>{ theme = presets.gold; applyTheme(theme); localStorage.setItem('bj_theme', JSON.stringify(theme)); });

  bgColor.addEventListener('input', ()=>{ document.documentElement.style.setProperty('--bg', bgColor.value); theme.bg = bgColor.value; localStorage.setItem('bj_theme', JSON.stringify(theme)); });
  accentColor.addEventListener('input', ()=>{ document.documentElement.style.setProperty('--accent', accentColor.value); theme.accent = accentColor.value; localStorage.setItem('bj_theme', JSON.stringify(theme)); });
  glowColor.addEventListener('input', ()=>{ document.documentElement.style.setProperty('--glow', hexToRgba(glowColor.value, 0.18)); theme.glow = hexToRgba(glowColor.value,0.18); localStorage.setItem('bj_theme', JSON.stringify(theme)); });
  scaleRange.addEventListener('input', ()=>{ document.documentElement.style.setProperty('--ui-scale', scaleRange.value); scaleVal.textContent = Math.round(scaleRange.value*100) + '%'; theme.scale = scaleRange.value; localStorage.setItem('bj_theme', JSON.stringify(theme)); });
  saveThemeBtn.addEventListener('click', ()=>{ localStorage.setItem('bj_theme', JSON.stringify(theme)); alert('Theme saved'); });
  resetThemeBtn.addEventListener('click', ()=>{ localStorage.removeItem('bj_theme'); theme={}; applyTheme(presets.neon); alert('Theme reset'); });

  function hexToRgba(hex, a=0.18){ if(!hex) return ''; const h = hex.replace('#',''); const r=parseInt(h.substring(0,2),16), g=parseInt(h.substring(2,4),16), b=parseInt(h.substring(4,6),16); return `rgba(${r}, ${g}, ${b}, ${a})`; }

  function loadTheme(){ const saved = JSON.parse(localStorage.getItem('bj_theme') || 'null'); if(saved){ theme = saved; applyTheme(saved); if(saved.scale){ document.documentElement.style.setProperty('--ui-scale', saved.scale); scaleRange.value = saved.scale; scaleVal.textContent = Math.round(saved.scale*100)+'%'; } } else { applyTheme(presets.neon); } }
  function saveState(){ localStorage.setItem('bj_bank', String(bank)); localStorage.setItem('bj_stats', JSON.stringify(stats)); localStorage.setItem('bj_history', JSON.stringify(history)); }

  // helpers used earlier but define safely
  function addHistory(msg,outcome){ const entry={t:Date.now(),msg:msg,outcome:outcome,player:player.map(c=>c.rank+c.suit),dealer:dealer.map(c=>c.rank+c.suit),pTotal:bestTotal(player),dTotal:bestTotal(dealer)}; history.unshift(entry); if(history.length>200) history.pop(); localStorage.setItem('bj_history', JSON.stringify(history)); renderHistory(); }
  function renderHistory(){ clearEl(historyList); for(const h of history){ const div=document.createElement('div'); div.className='history-item'; const l1=document.createElement('div'); l1.style.display='flex'; l1.style.justifyContent='space-between'; l1.innerHTML=`<div style="color:var(--muted)">${new Date(h.t).toLocaleTimeString()}</div><div>${h.outcome? (h.outcome==='win'?'<span class="outcome-win">WIN</span>':(h.outcome==='lose'?'<span class="outcome-lose">LOSE</span>':'<span class="outcome-push">PUSH</span>')):''}</div>`; const l2=document.createElement('div'); l2.style.color='var(--muted)'; l2.style.fontSize='13px'; l2.textContent = `${h.msg} Â· P:${h.player.join(' ')} (${h.pTotal}) Â· D:${h.dealer.join(' ')} (${h.dTotal})`; div.appendChild(l1); div.appendChild(l2); historyList.appendChild(div); } }

  // init load
  loadTheme(); init();

})();
</script>
</body>
</html>
